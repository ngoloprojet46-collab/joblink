{% extends 'base.html' %}
{% load static %}

{% block content %}

<style>
.pub-section h2 {
    font-weight: 700;
}

.pub-slide h2 {
    font-size: 2.2rem;
    text-shadow: 0 2px 6px rgba(0,0,0,0.7);
}

.pub-slide p {
    text-shadow: 0 2px 4px rgba(0,0,0,0.6);
}

.pub-slide a.btn {
    padding: 12px 28px;
    font-size: 1.1rem;
    border-radius: 50px;
}

.carousel-control-prev-icon,
.carousel-control-next-icon {
    filter: brightness(0) invert(1);
}

.pub-slide {
    transition: background 0.7s ease-in-out;
}
</style>

<style>
.pub-section h2 {
    font-weight: 700;
}

.pub-slide h2 {
    font-size: 2.6rem;
    text-shadow: 0 2px 6px rgba(0,0,0,0.7);
}

.pub-slide p {
    font-size: 1.3rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.6);
}

.pub-slide a.btn {
    padding: 10px 25px;
    border-radius: 50px;
    font-size: 1.1rem;
}
</style>

<style>
.hero-section {
    position: relative;
    background: url("https://res.cloudinary.com/dxndciemg/image/upload/v1763770573/bouak%C3%A94_wkihwv.jpg") no-repeat center center;
    background-size: cover;
    color: white;
    overflow: hidden;
}

.hero-section .overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5); /* couche sombre pour rendre le texte lisible */
    z-index: 1;
}

.hero-section .container {
    position: relative; /* pour que le contenu soit au-dessus de l'overlay */
    z-index: 2;
}
</style>

<!-- Section d‚Äôaccueil avec image de fond -->
<section class="hero-section py-5 text-center rounded-3 shadow-sm">
    <div class="overlay"></div>
    <div class="container position-relative">
        <h1 class="display-4 fw-bold">Bienvenue sur JobLink</h1>
        <p class="lead mb-4">
            Trouvez facilement les meilleurs prestataires de services dans votre ville ‚Äî 
            ou proposez vos comp√©tences √† ceux qui en ont besoin !
        </p>

        {% if user.is_authenticated %}
            <a href="{% url 'service_list' %}" class="btn btn-primary btn-lg me-2">
                Voir les services disponibles
            </a>
            <a href="{% url 'add_service' %}" class="btn btn-outline-light btn-lg">
                Publier un service
            </a>
        {% else %}
            <a href="{% url 'register' %}" class="btn btn-primary btn-lg me-2">
                Cr√©er un compte
            </a>
            <a href="{% url 'login' %}" class="btn btn-outline-light btn-lg">
                Se connecter
            </a>
        {% endif %}
    </div>
</section>

<!-- BOUTON BOUTIQUES SANS MARGE EXCESSIVE -->
<div class="text-center py-4" style="background: #dfe1e4;">
    <a href="{% url 'boutiques_list' %}" 
       class="btn btn-gradient btn-lg px-5 py-3 shadow-lg rounded-pill text-white fw-bold"
       style="
           background: linear-gradient(90deg, #4e54c8, #8f94fb);
           transition: transform 0.2s, box-shadow 0.2s;
       "
       onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)';"
       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)';">
        <i class="bi bi-shop me-2"></i> Voir les boutiques
    </a>
</div>


<!-- CARROUSEL DANS LA M√äME SECTION SOMBRE -->
<section class="pub-section py-5" style="background: #afb4b6;">
  <div class="container">

    <div id="pubCarousel" class="carousel slide shadow-lg rounded-3 overflow-hidden"
         data-bs-ride="carousel" data-bs-interval="3000">

      <div class="carousel-inner">
        {% for service in services %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}">
          <div class="pub-slide d-flex align-items-center justify-content-center text-center text-white"
               style="background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)),
                      url('{% if service.image %}{{ service.image.url }}{% else %}https://res.cloudinary.com/dxndciemg/image/upload/v1763993564/job1_nlecfm.jpg{% endif %}')
                      center/cover; min-height: 380px;">
            <div>
              <h2 class="fw-bold mb-3">{{ service.titre }}</h2>
              <p class="lead mb-2">
                <span class="fw-bold text-warning">{{ service.prix }} FCFA</span>
              </p>
              <p class="small mb-4">{{ service.description|truncatewords:15 }}</p>
              <a href="{% url 'service_detail' service.id %}" class="btn btn-outline-light btn-lg">
                Voir le service
              </a>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>



      <!-- Fl√®ches -->
      <button class="carousel-control-prev" type="button" data-bs-target="#pubCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#pubCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
      </button>
    </div>
  </div>
</section>


<!-- Section des services r√©cents -->
<section class="mt-5">
    <div class="container">
        <h2 class="text-center mb-4">Services r√©cents</h2>

        <div class="row">
            {% for service in services %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100 shadow-sm border-0">
                        
                        <!-- üñº Image ou üé• Vid√©o -->
                        {% if service.image %}
                            <a href="{{ service.image.url }}" data-bs-toggle="modal" data-bs-target="#mediaModal{{ service.id }}">
                                <img src="{{ service.image.url }}" 
                                     class="card-img-top rounded-top"
                                     alt="Image du service"
                                     style="height: 200px; object-fit: cover; border-radius: 12px; cursor: pointer;">
                            </a>

                        {% elif service.video %}
                        <div class="position-relative">
                            <video class="card-img-top rounded-top" 
                                    style="height: 200px; object-fit: cover; border-radius: 12px;"
                                    controls>
                                    <source src="{{ service.video.url }}" type="video/mp4">
                                    Votre navigateur ne supporte pas la lecture vid√©o.
                            </video>


                            <!-- Bouton lecture au centre -->
                        </div>

                        {% else %}
                            <img src="https://res.cloudinary.com/dxndciemg/image/upload/v1763993564/job1_nlecfm.jpg"
                                class="card-img-top rounded-top"
                                alt="Aucun m√©dia disponible"
                                style="height: 200px; object-fit: cover; border-radius: 12px;">
                        {% endif %}

                        <!-- Corps de la carte -->
                        <div class="card-body">
                            <h5 class="card-title text-primary">{{ service.titre }}</h5>
                            <p class="fw-bold text-success mb-1">{{ service.prix }} FCFA</p>
                            <p class="text-muted small mb-2">Cat√©gorie : {{ service.categorie }}</p>

                            {% if user.is_authenticated %}
                                <p class="card-text">{{ service.description|truncatewords:25 }}</p>
                                <a href="{% url 'service_detail' service.pk %}" class="btn btn-outline-primary btn-sm">
                                    Voir plus
                                </a>
                            {% else %}
                                <p class="text-muted fst-italic">Connectez-vous pour voir plus de d√©tails</p>
                                <a href="{% url 'login' %}" class="btn btn-primary btn-sm">Connexion</a>
                            {% endif %}
                        </div>

                        <div class="card-footer text-muted small">
                            Publi√© le {{ service.date_publication|date:"d/m/Y" }}
                        </div>
                    </div>
                </div>

                <!-- ü™ü Fen√™tre modale pour afficher image/vid√©o en grand -->
                <div class="modal fade" id="mediaModal{{ service.id }}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content border-0 shadow-lg">
                            <div class="modal-header border-0">
                                <h5 class="modal-title text-primary">{{ service.titre }}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                            </div>
                            <div class="modal-body text-center">
                                {% if service.image %}
                                    <img src="{{ service.image.url }}" class="img-fluid rounded shadow" alt="Image du service">
                                {% elif service.video %}
                                <video controls class="w-100 rounded shadow">
                                    <source src="{{ service.video.url }}" type="video/mp4">
                                </video>
                                {% endif %}

                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}
