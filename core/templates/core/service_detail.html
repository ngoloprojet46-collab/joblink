{% extends 'base.html' %}

{% load static %}

{% block title %}{{ service.titre }} - JobLink{% endblock %}

{% block extra_head %}
<meta property="og:title" content="{{ service.titre }}" />
<meta property="og:description" content="{{ service.description|truncatechars:150 }}" />

<meta property="og:url" content="{{ request.scheme }}://{{ request.get_host }}{% url 'service_detail' service.id %}" />

{% if service.image %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ service.image.url }}" />
{% elif service.video %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ service.video.url }}" />
{% else %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'default_service.png' %}" />
{% endif %}

<meta property="og:type" content="website" />
<meta property="og:site_name" content="JobLink" />
{% endblock %}


{% block content %}
<div class="container mt-5">
    <div class="card shadow-lg border-0 rounded-4">
        <div class="card-body">
            <h2 class="card-title text-primary fw-bold mb-3 text-center">
                <i class="bi bi-briefcase-fill"></i> {{ service.titre }}
            </h2>

            <!-- Image ou vidéo du service -->
            <div class="text-center mb-4">
                {% if service.image %}
                    <img src="{{ service.image.url }}" 
                        class="img-fluid rounded shadow"
                        style="max-height:400px; object-fit:cover;">
                
                {% elif service.video %}
                    <video controls class="w-100 rounded shadow" style="max-height:400px;">
                        <source src="{{ service.video.url }}">
                        Votre navigateur ne supporte pas la vidéo.
                    </video>
                
                {% else %}
                    <img src="{% static 'default_service.png' %}" 
                        class="img-fluid rounded shadow"
                        style="max-height:400px;">
                {% endif %}
            </div>

            <div class="row text-center text-md-start mb-4">
                <div class="col-md-3 mb-2 mb-md-0">
                    <i class="bi bi-tag-fill"></i> <strong>Catégorie :</strong> {{ service.categorie }}
                </div>
                <div class="col-md-3 mb-2 mb-md-0">
                    <i class="bi bi-currency-dollar"></i> <strong>Prix :</strong> {{ service.prix }} FCFA
                </div>
                <div class="col-md-3 mb-2 mb-md-0">
                    <i class="bi bi-person-fill"></i> <strong>Prestataire :</strong> {{ service.prestataire.user.username }}
                </div>
                <div class="col-md-3">
                    <i class="bi bi-calendar-event-fill"></i> <strong>Publié le :</strong> {{ service.date_publication|date:"d M Y" }}
                </div>
            </div>

            <hr>

            <p class="card-text fs-5 text-center text-md-start mb-4">
                {{ service.description }}
            </p>

            <div class="text-center mb-4">
                {% if service.disponible %}
                    <span class="badge bg-success fs-6 px-3 py-2">Disponible</span>
                {% else %}
                    <span class="badge bg-danger fs-6 px-3 py-2">Indisponible</span>
                {% endif %}
            </div>

            <div class="d-flex flex-column flex-md-row justify-content-center gap-3">
                <button type="button"
                        onclick="history.back()"
                        class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-arrow-left"></i> Retour
                </button>

                {% if user == service.prestataire.user %}
                    <a href="{% url 'modifier_service' service.id %}" class="btn btn-warning btn-lg text-white">
                        <i class="bi bi-pencil-fill"></i> Modifier
                    </a>
                    <a href="{% url 'supprimer_service' service.id %}" class="btn btn-danger btn-lg">
                        <i class="bi bi-trash-fill"></i> Supprimer
                    </a>
                {% endif %}

                {% if user.is_authenticated %}
                    <form method="post" action="{% url 'commander_service' service.id %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="bi bi-cart-check-fill"></i> Commander ce service
                        </button>
                    </form>
                {% else %}
                    <a href="{% url 'login' %}" class="btn btn-secondary btn-lg">
                        Connectez-vous pour commander
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
