{% extends "base.html" %}

{% block content %}
<div class="abonnement-container" style="max-width:600px; margin:auto; padding:20px; background:#f9f9f9; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
    <h2 style="text-align:center; margin-bottom:20px;">Mon Abonnement</h2>

    <p><strong>Statut :</strong> 
        {% if abonnement.est_actif %} 
            <span style="color:green;">Actif jusqu'au {{ abonnement.date_fin }}</span>
        {% else %}
            <span style="color:red;">Expiré</span>
        {% endif %}
    </p>

    <p><strong>Date de début :</strong> {{ abonnement.date_debut }}</p>
    <p><strong>Date de fin :</strong> {{ abonnement.date_fin }}</p>

    <hr style="margin:20px 0;">

    <h3>Paiement de l’abonnement</h3>
    <p>Pour prolonger votre abonnement, payez 500 FCFA (mois) via ce lien :</p>
    <a href="{{ lien_paiement }}" target="_blank" style="display:inline-block; padding:10px 20px; background:#007bff; color:white; text-decoration:none; border-radius:5px;">Payer maintenant</a>

    <hr style="margin:20px 0;">

    <h3>Envoyer la preuve de paiement</h3>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" style="padding:10px 20px; background:#28a745; color:white; border:none; border-radius:5px; cursor:pointer;">Envoyer</button>
    </form>

    {% if abonnement.preuve_paiement %}
        <div style="margin-top:20px;">
            <p><strong>Preuve envoyée :</strong></p>

            {% if abonnement.preuve_paiement.url %}
                {% if abonnement.preuve_paiement|slice:"-4:" == ".jpg" or abonnement.preuve_paiement|slice:"-4:" == ".png" or abonnement.preuve_paiement|slice:"-5:" == ".jpeg" %}
                    <!-- AFFICHAGE IMAGE CLOUDINARY -->
                    <img src="{{ abonnement.preuve_paiement.url }}" 
                         style="max-width:100%; border-radius:8px; margin-top:10px;" 
                         alt="Preuve de paiement">
                {% else %}
                    <!-- AFFICHAGE PDF OU AUTRE FICHIER -->
                    <a href="{{ abonnement.preuve_paiement.url }}" target="_blank" 
                       style="color:#007bff; text-decoration:underline;">
                        Télécharger / Voir la preuve
                    </a>
                {% endif %}
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}
