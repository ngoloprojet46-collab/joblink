{% extends 'base.html' %}
{% load static %}
{% block content %}

<style>
  /* Style global du profil */
  .profile-card {
    background: linear-gradient(145deg, #ffffff, #f0f4f8);
    border-radius: 1rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    padding: 2rem;
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .profile-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
  }

  .profile-avatar {
    width: 120px;
    height: 120px;
    object-fit: cover;
    border-radius: 50%;
    border: 4px solid #0d6efd;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: transform 0.3s;
  }

  .profile-avatar:hover {
    transform: scale(1.05);
  }

  .profile-icon {
    font-size: 6rem;
    color: #0d6efd;
  }

  .profile-form button {
    background: #0d6efd;
    border: none;
    color: white;
    transition: background 0.3s;
  }

  .profile-form button:hover {
    background: #0b5ed7;
  }

  .alert {
    font-weight: 500;
    text-align: center;
  }

</style>

<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="profile-card">

        <h2 class="text-center mb-4 text-primary fw-bold">
          Mon Profil
        </h2>

        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-success">{{ message }}</div>
          {% endfor %}
        {% endif %}

        <div class="text-center mb-4">
          {% if user.photo %}
            <img src="{{ user.photo.url }}" class="profile-avatar shadow-sm"
                 onclick="ouvrirPhoto('{{ user.photo.url }}')">
          {% else %}
            <i class="bi-person-circle profile-icon"></i>
          {% endif %}
        </div>

        <form method="POST" enctype="multipart/form-data" class="profile-form">
          {% csrf_token %}
          {{ form.as_p }}
          <div class="d-flex justify-content-center mt-3">
            <button type="submit" class="btn fw-semibold py-2 px-4 rounded-3">
              Mettre Ã  jour
            </button>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>

<!-- Modal Global Photo -->
<div class="modal fade" id="photoModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-dark border-0 text-center p-3">

      <button type="button"
              class="btn-close btn-close-white ms-auto"
              data-bs-dismiss="modal">
      </button>

      <img id="photoModalImage"
           src=""
           class="rounded shadow"
           style="max-height:85vh; max-width:90vw; object-fit: contain; display:block; margin:0 auto;">
    </div>
  </div>
</div>

<script>
function ouvrirPhoto(url) {
    let image = document.getElementById("photoModalImage");
    image.src = url;

    let modal = new bootstrap.Modal(document.getElementById('photoModal'));
    modal.show();
}
</script>

{% endblock %}