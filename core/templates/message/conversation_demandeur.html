{% extends 'base.html' %}
{% block content %}
<div class="container py-4">

    <!-- ðŸ”™ Bouton retour -->
    <a href="{% url 'boite_messages_demandeur' %}" class="btn btn-secondary mb-3">
        â¬… Retour Ã  la boÃ®te
    </a>

    <h2 class="text-center text-primary mb-4">
        Conversation avec {{ prestataire.username }} <br>
        <small class="text-muted">Service : Â« {{ service.titre }} Â»</small>
    </h2>

    <div class="card shadow-sm p-4 mb-4" style="max-height: 400px; overflow-y: auto;">
        {% for msg in conversation %}
            <div class="mb-3 {% if msg.sender_user == request.user %}text-end{% endif %}">
                
                <span class="badge {% if msg.sender_user == request.user %}bg-primary{% else %}bg-secondary{% endif %}">
                    {{ msg.sender_user.username }}
                </span>

                <p class="mt-1">{{ msg.content }}</p>
                
                <small class="text-muted">{{ msg.date_sent|date:"d/m/Y H:i" }}</small>
            </div>
        {% empty %}
            <p class="text-muted">Aucun message pour le moment.</p>
        {% endfor %}
    </div>

    <form method="post">
        {% csrf_token %}
        <div class="mb-3">
            <label class="form-label">Votre message :</label>
            <textarea name="content" class="form-control" rows="3" required></textarea>
        </div>
        <button class="btn btn-success">Envoyer</button>
    </form>

</div>
{% endblock %}
